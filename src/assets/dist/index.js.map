{"version":3,"sources":["index.js","../node_modules/graphql-quest/dist/quest.es.js","utils.js","queries.js","CommentController.js"],"names":["e","endpoint","fetchOptions","t","query","n","variables","r","a","JSON","stringify","method","o","headers","s","i","toLowerCase","c","URL","searchParams","append","toString","fetch","toUpperCase","body","data","errors","json","send","dateFromUnix","unix","Date","Number","toISOString","date","hoursOffset","getTimezoneOffset","dateString","setHours","getHours","toLocaleString","split","trim","htmlElementCollection","reduce","acc","item","name","value","getTime","shell","minimumSubmissionTime","loadingSvg","querySelector","commentCount","commentList","message","client","QuestClient","bumpCount","number","parseInt","textContent","hideLoadingSvg","style","display","showError","firstElementChild","innerText","appendComment","commentData","createdAt","id","clonedItem","cloneNode","forEach","property","querySelectorAll","href","insertBefore","firstChild","addEventListener","preventDefault","form","target","startTime","elements","content","domain","emailAddress","path","dataset","jamCommentsUrl","window","location","pathname","CREATE_COMMENT_QUERY","then","result","remaining","delay","setTimeout","createComment","reset","document"],"mappings":"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","file":"index.js","sourceRoot":"../js","sourcesContent":["import CommentController from \"./CommentController\";\n\nexport { CommentController };\n","async function e({endpoint:e,fetchOptions:t,query:n,variables:r}){const a={query:n,variables:JSON.stringify(r)},{method:o=\"POST\",headers:s={}}=t,i=\"get\"===o.toLowerCase(),c=i?function(e,t){const n=new URL(e);for(const e in t)n.searchParams.append(e,t[e]);return n.toString()}(e,a):e;try{const e=await fetch(c,{method:o.toUpperCase(),headers:{\"Content-Type\":\"application/\"+(i?\"x-www-form-urlencoded\":\"json\"),...s},body:i?null:JSON.stringify(a)}),{data:t,errors:n}=await e.json(),r={data:t};return n&&(r.errors=n),r}catch(e){return{errors:[e]}}}async function t(t,n,r={},a={}){return await e({endpoint:t,query:n,variables:r,fetchOptions:a})}function n({endpoint:t,method:n,headers:r}){return{send:async(a,o={})=>await e({endpoint:t,query:a,variables:o,fetchOptions:{method:n,headers:r}})}}export{n as QuestClient,t as quest};\n","/**\n * Given a timestamp, convert it to a Date object.\n *\n * @param {number} unix\n * @return {Date}\n */\nexport const dateFromUnix = (unix) => {\n  return new Date(Number(unix));\n};\n\n/**\n * Convert unix timestamp to ISO string.\n *\n * @param {number} unix\n * @return {string}\n */\nexport const toIsoString = (unix) => {\n  return dateFromUnix(unix).toISOString();\n};\n\n/**\n * Convert a Unix timestamp to a nice, pretty format.\n *\n * @param {integer} unix\n * @return {string}\n */\nexport const toPrettyDate = (unix) => {\n  let date = dateFromUnix(unix);\n  let hoursOffset = date.getTimezoneOffset() / 60;\n  date.setHours(date.getHours() - hoursOffset);\n  let dateString = date.toLocaleString(\"en-US\").split(\",\");\n  return dateString[0].trim();\n};\n\n/**\n * Given a list of elements, convert the values into an object.\n *\n * @param {NodeList} htmlElementCollection\n * @return {object}\n */\nexport const formatFormValues = (htmlElementCollection) => {\n  return [...htmlElementCollection].reduce((acc, item) => {\n    if (!item.name) return acc;\n\n    acc[item.name] = item.value;\n    return acc;\n  }, {});\n};\n\nexport const getCurrentTime = () => new Date().getTime();\n","export const CREATE_COMMENT_QUERY = `\n  mutation CreateComment(\n    $name: String!,\n    $path: String!,\n    $content: String!,\n    $domain: String!,\n    $emailAddress: String\n  ){\n    createComment(\n      name: $name,\n      path: $path,\n      content: $content,\n      emailAddress: $emailAddress\n      domain: $domain\n    ) {\n      createdAt\n      name\n      emailAddress\n      content\n      id\n      site {\n        domain\n      }\n    }\n  }\n`;\n","import { QuestClient } from \"graphql-quest\";\nimport { formatFormValues, getCurrentTime, toPrettyDate } from \"./utils\";\nimport { CREATE_COMMENT_QUERY } from \"./queries\";\n\nexport default function CommentController(shell) {\n  const minimumSubmissionTime = 1000;\n  const loadingSvg = shell.querySelector(\".jc-CommentBox-loadingDots\");\n  const commentCount = shell.querySelector(\n    '[data-jam-comments-component=\"count\"]'\n  );\n  const commentList = shell.querySelector(\n    '[data-jam-comments-component=\"list\"]'\n  );\n  const message = shell.querySelector(\n    '[data-jam-comments-component=\"message\"]'\n  );\n  const client = new QuestClient({\n    endpoint: \"https://service.jamcomments.com/graphql\",\n    headers: {\n      \"x-api-key\": \"JAM_COMMENTS_API_KEY\",\n    },\n  });\n\n  /**\n   * When textarea is focused upon, show all inputs.\n   *\n   * @return {void}\n   */\n  const listenForTextareaFocus = () => {\n    shell.querySelector('[name=\"content\"]').addEventListener(\"focus\", (e) => {\n      [...shell.querySelectorAll(\".jc-CommentBox-contactInput\")].forEach(\n        (i) => {\n          i.style.display = \"flex\";\n        }\n      );\n    });\n  };\n\n  /**\n   * When form is submitted, send to service & respond accordingly.\n   *\n   * @return {void}\n   */\n  const listenForSubmission = () => {\n    shell.querySelector(\"form\").addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const form = e.target;\n\n      const startTime = getCurrentTime();\n      const { content, name, emailAddress } = formatFormValues(form.elements);\n\n      const variables = {\n        name,\n        domain: \"JAM_COMMENTS_DOMAIN\",\n        content,\n        emailAddress,\n        path: shell.dataset.jamCommentsUrl || window.location.pathname,\n      };\n\n      // Show the loading dots.\n      loadingSvg.style.display = \"\";\n\n      client.send(CREATE_COMMENT_QUERY, variables).then((result) => {\n        const remaining =\n          minimumSubmissionTime - (getCurrentTime() - startTime);\n        const delay = remaining > 0 ? remaining : 0;\n\n        if (result.errors || !result.data) {\n          hideLoadingSvg();\n          return showError();\n        }\n\n        setTimeout(() => {\n          hideLoadingSvg();\n          appendComment(result.data.createComment);\n          bumpCount();\n          form.reset();\n        }, delay);\n      });\n    });\n  };\n\n  /**\n   * Bump the number of comments listed on the page.\n   *\n   * @return {void}\n   */\n  const bumpCount = () => {\n    const number = parseInt(commentCount.textContent);\n\n    commentCount.textContent = number + 1;\n  };\n\n  /**\n   * Hide the loading SVG.\n   *\n   * @return {void}\n   */\n  const hideLoadingSvg = () => {\n    loadingSvg.style.display = \"none\";\n  };\n\n  /**\n   * Display a generic error message.\n   *\n   * @return {void}\n   */\n  const showError = () => {\n    message.style.display = \"\";\n    message.firstElementChild.innerText =\n      \"Oh no! Something went wrong while trying to submit that comment.\";\n  };\n\n  /**\n   * Clone list item and attach to list of comments with latest comment data.\n   *\n   * @return {void}\n   */\n  const appendComment = (commentData) => {\n    const contentKeysToReplace = [\"content\", \"createdAt\", \"name\"];\n\n    commentData.createdAt = toPrettyDate(commentData.createdAt);\n\n    const { id } = commentData;\n    const clonedItem = commentList.querySelector(\"li\").cloneNode(true);\n\n    // Set the text content for each element piece.\n    contentKeysToReplace.forEach((property) => {\n      const node = clonedItem.querySelector(\n        `[data-jam-comments-component=\"${property}\"]`\n      );\n      node.innerText = commentData[property];\n    });\n\n    clonedItem.querySelectorAll(\n      '[data-jam-comments-component=\"anchor\"]'\n    ).href = `#comment-${id}`;\n\n    clonedItem.style.display = \"\";\n\n    commentList.insertBefore(clonedItem, commentList.firstChild);\n  };\n\n  listenForSubmission();\n  listenForTextareaFocus();\n}\n"]}